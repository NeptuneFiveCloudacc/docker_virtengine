FROM ubuntu:16.04
MAINTAINER Megam systems  <info@megam.io>

ENV DEB_VERSION 1.5.2
ENV RELEASE testing
ENV DEBIAN_FRONTEND noninteractive

ENV ONE_URL https://get.megam.io/repo/$DEB_VERSION/ubuntu/16.04/$RELEASE xenial $RELEASE

# Install systemd:
RUN apt-get update && apt-get install -y systemd

# In order to gracefully stop systemd we need to set the stop signal to
# SIGRTMIN+3 and set the container environment variable
STOPSIGNAL SIGRTMIN+3
ENV container docker

# No need for graphical.target here
RUN systemctl set-default multi-user.target

ENTRYPOINT ["/sbin/init"]

RUN buildDeps=' \
         nsqd \
      ' \
     set -x \
     && apt-get update \
     && apt-get -y install software-properties-common  git nano apt-transport-https wget  apt-utils  ca-certificates netcat-openbsd \
     && apt-add-repository "deb [arch=amd64] $ONE_URL" \
     && apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 9B46B611 \
     && apt-get update \
     && apt-get -y install $buildDeps
#     && systemctl start nsqadmin; systemctl start nsqlookupd

 COPY start.sh  /

 EXPOSE  9000 8000 4150 4151 4160 4161  4171

 CMD ["/bin/bash",nsqd","nsqadmin","nsqlookupd"]
#ENTRYPOINT ["/start.sh"]
